-- ‚úÖ –ê–≤—Ç–æ-—Å–±–æ—Ä, –ø—Ä–æ–¥–∞–∂–∞, —Ç–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π, –∫–∞–º–µ—Ä–æ–π —Å–≤–µ—Ä—Ö—É –∏ —Å–µ—Ä–≤–µ—Ä-—Ö–æ–ø —Å GUI –¥–ª—è –≤—Ä–µ–º–µ–Ω–∏
local Players = game:GetService("Players")
local TeleportService = game:GetService("TeleportService")
local HttpService = game:GetService("HttpService")
local RunService = game:GetService("RunService")
local player = Players.LocalPlayer
local character = player.Character or player.CharacterAdded:Wait()
local humanoidRootPart = character:WaitForChild("HumanoidRootPart")
local PlaceId = game.PlaceId

------------------------------------------------------------
-- üü¶ GUI
------------------------------------------------------------
local playerGui = player:WaitForChild("PlayerGui")
local screenGui = Instance.new("ScreenGui")
screenGui.Name = "AutoCollectorUI"
screenGui.Parent = playerGui

local frame = Instance.new("Frame")
frame.Size = UDim2.new(0, 260, 0, 220)
frame.Position = UDim2.new(0, 25, 0.5, -110)
frame.BackgroundColor3 = Color3.fromRGB(35, 35, 50)
frame.BorderSizePixel = 0
frame.Parent = screenGui

local startBtn = Instance.new("TextButton")
startBtn.Size = UDim2.new(1, -20, 0, 40)
startBtn.Position = UDim2.new(0, 10, 0, 10)
startBtn.Text = "‚ñ∂ –°—Ç–∞—Ä—Ç"
startBtn.BackgroundColor3 = Color3.fromRGB(50, 160, 70)
startBtn.TextColor3 = Color3.new(1,1,1)
startBtn.Font = Enum.Font.SourceSansBold
startBtn.TextSize = 20
startBtn.Parent = frame

local stopBtn = Instance.new("TextButton")
stopBtn.Size = UDim2.new(1, -20, 0, 40)
stopBtn.Position = UDim2.new(0, 10, 0, 60)
stopBtn.Text = "‚ñ† –°—Ç–æ–ø"
stopBtn.BackgroundColor3 = Color3.fromRGB(160, 60, 60)
stopBtn.TextColor3 = Color3.new(1,1,1)
stopBtn.Font = Enum.Font.SourceSansBold
stopBtn.TextSize = 20
stopBtn.Parent = frame

local counterLabel = Instance.new("TextLabel")
counterLabel.Size = UDim2.new(1, -20, 0, 30)
counterLabel.Position = UDim2.new(0, 10, 0, 110)
counterLabel.BackgroundTransparency = 1
counterLabel.TextColor3 = Color3.new(1,1,1)
counterLabel.Font = Enum.Font.SourceSansBold
counterLabel.TextSize = 18
counterLabel.Text = "–ü–æ–¥–æ–±—Ä–∞–Ω–æ: 0"
counterLabel.Parent = frame

local hopLabel = Instance.new("TextLabel")
hopLabel.Size = UDim2.new(1, -20, 0, 25)
hopLabel.Position = UDim2.new(0, 10, 0, 145)
hopLabel.BackgroundTransparency = 1
hopLabel.TextColor3 = Color3.new(1,1,1)
hopLabel.Font = Enum.Font.SourceSans
hopLabel.TextSize = 16
hopLabel.Text = "–°–µ—Ä–≤–µ—Ä-—Ö–æ–ø –∫–∞–∂–¥—ã–µ (—Å–µ–∫):"
hopLabel.Parent = frame

local hopInput = Instance.new("TextBox")
hopInput.Size = UDim2.new(1, -20, 0, 25)
hopInput.Position = UDim2.new(0, 10, 0, 170)
hopInput.BackgroundColor3 = Color3.fromRGB(50,50,60)
hopInput.TextColor3 = Color3.new(1,1,1)
hopInput.Font = Enum.Font.SourceSans
hopInput.TextSize = 16
hopInput.PlaceholderText = "–í–≤–µ–¥–∏—Ç–µ —á–∏—Å–ª–æ, –Ω–∞–ø—Ä–∏–º–µ—Ä 60"
hopInput.Text = "60"
hopInput.ClearTextOnFocus = false
hopInput.Parent = frame

------------------------------------------------------------
-- ‚öôÔ∏è –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
------------------------------------------------------------
local isRunning = false
local collectedCount = 0
local itemsFolder = workspace:FindFirstChild("Item_Spawns") and workspace.Item_Spawns:FindFirstChild("Items")
local TELEPORT_STEP = 50
local TELEPORT_DELAY = 0.03
local SERVER_HOP_INTERVAL = tonumber(hopInput.Text) or 60 -- —Å–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

hopInput.FocusLost:Connect(function(enterPressed)
	local num = tonumber(hopInput.Text)
	if num and num > 0 then
		SERVER_HOP_INTERVAL = num
		print("[‚ÑπÔ∏è] –í—Ä–µ–º—è –¥–ª—è —Å–µ—Ä–≤–µ—Ä-—Ö–æ–ø–∞ –æ–±–Ω–æ–≤–ª–µ–Ω–æ –Ω–∞: " .. SERVER_HOP_INTERVAL .. " —Å–µ–∫")
	else
		hopInput.Text = tostring(SERVER_HOP_INTERVAL)
	end
end)

------------------------------------------------------------
-- NOCLIP (–≤—Å–µ–≥–¥–∞)
------------------------------------------------------------
RunService.RenderStepped:Connect(function()
	if character then
		for _,v in pairs(character:GetDescendants()) do
			if v:IsA('BasePart') then
				v.CanCollide = false
			end
		end
	end
end)

------------------------------------------------------------
-- üéØ –¶–µ–ª–∏ –¥–ª—è —Å–±–æ—Ä–∞
------------------------------------------------------------
local allowedItems = {
	["Mysterious Arrow"] = true,
	["Gold Coin"] = true,
	["Rokakaka"] = true,
	["Rib Cage of The Saint's Corpse"] = true,
	["Zeppelin's Headband"] = true,
	["Ancient Scroll"] = true,
	["Quinton's Glove"] = true,
	["Stone Mask"] = true,
	["Diamond"] = true,
	["Caesar's Headband"] = true,
	["Clackers"] = true
}

------------------------------------------------------------
-- üöÄ –¢–µ–ª–µ–ø–æ—Ä—Ç–∞—Ü–∏—è —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π
------------------------------------------------------------
local function safeTeleport(targetPos)
	if not humanoidRootPart or not character then return end

	local platform = Instance.new("Part")
	platform.Size = Vector3.new(10,1,10)
	platform.Anchored = true
	platform.CanCollide = true
	platform.Position = humanoidRootPart.Position - Vector3.new(0,3,0)
	platform.Parent = workspace

	local startPos = humanoidRootPart.Position
	local vector = targetPos - startPos
	local distance = vector.Magnitude
	local steps = math.ceil(distance / TELEPORT_STEP)
	local step = vector / steps

	for i = 1, steps do
		if not isRunning then break end
		humanoidRootPart.AssemblyLinearVelocity = Vector3.zero
		humanoidRootPart.CFrame = CFrame.new(humanoidRootPart.Position + step)
		platform.Position = humanoidRootPart.Position - Vector3.new(0,3,0)
		task.wait(TELEPORT_DELAY)
	end

	platform:Destroy()
end

------------------------------------------------------------
-- üß≤ –°–±–æ—Ä –ø—Ä–µ–¥–º–µ—Ç–æ–≤ —Å –∫–∞–º–µ—Ä–æ–π —Å–≤–µ—Ä—Ö—É
------------------------------------------------------------
local function moveAndCollect(model, prompt)
	local basePart = model:FindFirstChildWhichIsA("BasePart")
	if not basePart or not prompt then return end

	safeTeleport(basePart.Position)
	task.wait(0.05)

	local cam = workspace.CurrentCamera
	local oldType = cam.CameraType
	local oldCFrame = cam.CFrame
	cam.CameraType = Enum.CameraType.Scriptable
	cam.CFrame = CFrame.new(humanoidRootPart.Position + Vector3.new(0,30,0), basePart.Position)

	if prompt.Enabled then
		prompt:InputHoldBegin()
		task.wait((prompt.HoldDuration or 0.5) + 0.05)
		prompt:InputHoldEnd()
	end

	cam.CameraType = oldType
	cam.CFrame = oldCFrame

	local startTime = os.clock()
	while model.Parent == itemsFolder and os.clock() - startTime < 3 do
		task.wait(0.05)
	end

	collectedCount += 1
	counterLabel.Text = "–ü–æ–¥–æ–±—Ä–∞–Ω–æ: " .. collectedCount
end

------------------------------------------------------------
-- üí∞ –ü—Ä–æ–¥–∞–∂–∞ –ø—Ä–µ–¥–º–µ—Ç–æ–≤
------------------------------------------------------------
local SELL_DELAY = 0.2

local function sellItem(item)
	if not item then return end
	local foundItem = player.Backpack:FindFirstChild(item.Name)
	if foundItem then
		foundItem.Parent = workspace.Living:FindFirstChild(player.Name)
	end
	local remote = character:FindFirstChild("RemoteEvent")
	if remote then
		remote:FireServer("EndDialogue", {["NPC"]="Merchant", ["Option"]="Option2", ["Dialogue"]="Dialogue5"})
	end
end

local function sellAllowedItems()
	for _, item in pairs(player.Backpack:GetChildren()) do
		if allowedItems[item.Name] then
			sellItem(item)
			task.wait(SELL_DELAY)
		end
	end
end

------------------------------------------------------------
-- üîÅ –û—Å–Ω–æ–≤–Ω–æ–π —Ü–∏–∫–ª —Å–±–æ—Ä–∞ + —Å–µ—Ä–≤–µ—Ä-—Ö–æ–ø
------------------------------------------------------------
local function serverHop()
	local success, servers = pcall(function()
		return HttpService:JSONDecode(game:HttpGet("https://games.roblox.com/v1/games/"..PlaceId.."/servers/Public?sortOrder=Asc&limit=100"))
	end)
	if not success or not servers or not servers.data then return end

	local minPlayers, chosenServer = math.huge, nil
	for _, s in pairs(servers.data) do
		if s.playing < minPlayers and s.id ~= game.JobId then
			minPlayers = s.playing
			chosenServer = s.id
		end
	end

	if chosenServer then
		TeleportService:TeleportToPlaceInstance(PlaceId, chosenServer, player)
	end
end

local function mainAutoCollect()
	local lastHop = tick()
	while isRunning do
		if not itemsFolder then
			task.wait(1)
			itemsFolder = workspace:FindFirstChild("Item_Spawns") and workspace.Item_Spawns:FindFirstChild("Items")
		end

		for _, model in ipairs(itemsFolder:GetChildren()) do
			if not isRunning then break end
			local prompt = model:FindFirstChildWhichIsA("ProximityPrompt", true)
			if prompt and allowedItems[prompt.ObjectText] then
				moveAndCollect(model, prompt)
			end
		end

		sellAllowedItems()
		task.wait(0.05) -- –±—ã—Å—Ç—Ä–æ–µ —Å–∫–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ

		-- –°–µ—Ä–≤–µ—Ä-—Ö–æ–ø –ø–æ —Ç–∞–π–º–µ—Ä—É
		if tick() - lastHop >= SERVER_HOP_INTERVAL then
			lastHop = tick()
			print("[‚ÑπÔ∏è] –í—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Å–µ—Ä–≤–µ—Ä-—Ö–æ–ø...")
			serverHop()
			break -- –æ—Å—Ç–∞–Ω–æ–≤–∫–∞ —Å–∫—Ä–∏–ø—Ç–∞ –ø–æ—Å–ª–µ —Ö–æ–ø–∞
		end
	end
end

------------------------------------------------------------
-- ‚ñ∂Ô∏è –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
------------------------------------------------------------
local function startAutoCollect()
	if isRunning then return end
	isRunning = true
	collectedCount = 0
	counterLabel.Text = "–ü–æ–¥–æ–±—Ä–∞–Ω–æ: 0"
	task.spawn(mainAutoCollect)
end

local function stopAutoCollect()
	isRunning = false
end

startBtn.MouseButton1Click:Connect(startAutoCollect)
stopBtn.MouseButton1Click:Connect(stopAutoCollect)

print("[‚úÖ] –ê–≤—Ç–æ-—Å–±–æ—Ä —Å –ø–ª–∞—Ç—Ñ–æ—Ä–º–æ–π, –∫–∞–º–µ—Ä–æ–π —Å–≤–µ—Ä—Ö—É –∏ —Å–µ—Ä–≤–µ—Ä-—Ö–æ–ø–æ–º –∑–∞–ø—É—â–µ–Ω.")
